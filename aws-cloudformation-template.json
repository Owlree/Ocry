{
    "AWSTemplateFormatVersion": "2010-09-09",
    "Metadata": {
        "AWS::CloudFormation::Designer": {
            "0c458e02-382e-4316-82ff-0c9abf708819": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 640,
                    "y": 20
                },
                "z": 0,
                "embeds": []
            },
            "85e2cf8d-1306-4f4f-8dc1-f6fcfef1f509": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 640,
                    "y": -50
                },
                "z": 0,
                "embeds": []
            },
            "af816494-f425-45a7-bf88-b36269841cb8": {
                "size": {
                    "width": 270,
                    "height": 250
                },
                "position": {
                    "x": 320,
                    "y": 20
                },
                "z": 0,
                "embeds": [
                    "88c45b66-cfb7-4938-a232-98dcf9aef0a3",
                    "e08a9b03-443e-4b34-8dae-b84b7130c6a6",
                    "fb3b9ec7-7781-4a4e-a25b-92b22d3b8000"
                ]
            },
            "f9723173-6dfb-481f-887c-a638cb9eb807": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 400,
                    "y": 90
                },
                "z": 2,
                "parent": "88c45b66-cfb7-4938-a232-98dcf9aef0a3",
                "embeds": [],
                "iscontainedinside": [
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "88c45b66-cfb7-4938-a232-98dcf9aef0a3",
                    "88c45b66-cfb7-4938-a232-98dcf9aef0a3",
                    "88c45b66-cfb7-4938-a232-98dcf9aef0a3",
                    "88c45b66-cfb7-4938-a232-98dcf9aef0a3",
                    "88c45b66-cfb7-4938-a232-98dcf9aef0a3",
                    "88c45b66-cfb7-4938-a232-98dcf9aef0a3",
                    "88c45b66-cfb7-4938-a232-98dcf9aef0a3",
                    "88c45b66-cfb7-4938-a232-98dcf9aef0a3",
                    "88c45b66-cfb7-4938-a232-98dcf9aef0a3",
                    "88c45b66-cfb7-4938-a232-98dcf9aef0a3",
                    "88c45b66-cfb7-4938-a232-98dcf9aef0a3",
                    "88c45b66-cfb7-4938-a232-98dcf9aef0a3",
                    "88c45b66-cfb7-4938-a232-98dcf9aef0a3",
                    "88c45b66-cfb7-4938-a232-98dcf9aef0a3",
                    "88c45b66-cfb7-4938-a232-98dcf9aef0a3",
                    "88c45b66-cfb7-4938-a232-98dcf9aef0a3",
                    "88c45b66-cfb7-4938-a232-98dcf9aef0a3",
                    "88c45b66-cfb7-4938-a232-98dcf9aef0a3",
                    "88c45b66-cfb7-4938-a232-98dcf9aef0a3",
                    "88c45b66-cfb7-4938-a232-98dcf9aef0a3",
                    "88c45b66-cfb7-4938-a232-98dcf9aef0a3",
                    "88c45b66-cfb7-4938-a232-98dcf9aef0a3",
                    "88c45b66-cfb7-4938-a232-98dcf9aef0a3",
                    "88c45b66-cfb7-4938-a232-98dcf9aef0a3",
                    "88c45b66-cfb7-4938-a232-98dcf9aef0a3",
                    "88c45b66-cfb7-4938-a232-98dcf9aef0a3",
                    "88c45b66-cfb7-4938-a232-98dcf9aef0a3",
                    "88c45b66-cfb7-4938-a232-98dcf9aef0a3",
                    "88c45b66-cfb7-4938-a232-98dcf9aef0a3",
                    "88c45b66-cfb7-4938-a232-98dcf9aef0a3",
                    "88c45b66-cfb7-4938-a232-98dcf9aef0a3",
                    "88c45b66-cfb7-4938-a232-98dcf9aef0a3",
                    "88c45b66-cfb7-4938-a232-98dcf9aef0a3",
                    "88c45b66-cfb7-4938-a232-98dcf9aef0a3",
                    "88c45b66-cfb7-4938-a232-98dcf9aef0a3",
                    "88c45b66-cfb7-4938-a232-98dcf9aef0a3",
                    "88c45b66-cfb7-4938-a232-98dcf9aef0a3",
                    "88c45b66-cfb7-4938-a232-98dcf9aef0a3",
                    "88c45b66-cfb7-4938-a232-98dcf9aef0a3",
                    "88c45b66-cfb7-4938-a232-98dcf9aef0a3",
                    "88c45b66-cfb7-4938-a232-98dcf9aef0a3",
                    "88c45b66-cfb7-4938-a232-98dcf9aef0a3",
                    "88c45b66-cfb7-4938-a232-98dcf9aef0a3",
                    "88c45b66-cfb7-4938-a232-98dcf9aef0a3",
                    "88c45b66-cfb7-4938-a232-98dcf9aef0a3",
                    "88c45b66-cfb7-4938-a232-98dcf9aef0a3",
                    "88c45b66-cfb7-4938-a232-98dcf9aef0a3",
                    "88c45b66-cfb7-4938-a232-98dcf9aef0a3",
                    "88c45b66-cfb7-4938-a232-98dcf9aef0a3",
                    "88c45b66-cfb7-4938-a232-98dcf9aef0a3",
                    "88c45b66-cfb7-4938-a232-98dcf9aef0a3",
                    "88c45b66-cfb7-4938-a232-98dcf9aef0a3",
                    "88c45b66-cfb7-4938-a232-98dcf9aef0a3",
                    "88c45b66-cfb7-4938-a232-98dcf9aef0a3",
                    "88c45b66-cfb7-4938-a232-98dcf9aef0a3"
                ]
            },
            "88c45b66-cfb7-4938-a232-98dcf9aef0a3": {
                "size": {
                    "width": 200,
                    "height": 100
                },
                "position": {
                    "x": 380,
                    "y": 60
                },
                "z": 1,
                "parent": "af816494-f425-45a7-bf88-b36269841cb8",
                "embeds": [
                    "f9723173-6dfb-481f-887c-a638cb9eb807"
                ],
                "iscontainedinside": [
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8"
                ]
            },
            "fb3b9ec7-7781-4a4e-a25b-92b22d3b8000": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 510,
                    "y": 170
                },
                "z": 1,
                "parent": "af816494-f425-45a7-bf88-b36269841cb8",
                "embeds": [],
                "isassociatedwith": [
                    "e08a9b03-443e-4b34-8dae-b84b7130c6a6"
                ],
                "iscontainedinside": [
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8"
                ]
            },
            "e08a9b03-443e-4b34-8dae-b84b7130c6a6": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 390,
                    "y": 170
                },
                "z": 1,
                "parent": "af816494-f425-45a7-bf88-b36269841cb8",
                "embeds": [],
                "isassociatedwith": [
                    "fb3b9ec7-7781-4a4e-a25b-92b22d3b8000"
                ],
                "iscontainedinside": [
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8",
                    "af816494-f425-45a7-bf88-b36269841cb8"
                ],
                "dependson": [
                    "f9723173-6dfb-481f-887c-a638cb9eb807"
                ]
            },
            "63d535ce-4490-4542-8fcb-b412a5a3ce1b": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 640,
                    "y": 90
                },
                "z": 0,
                "embeds": []
            }
        }
    },
    "Resources": {
        "DocperDB": {
            "Type": "AWS::DynamoDB::Table",
            "Properties": {
                "TableName": {
                    "Ref": "DocperDBTableName"
                },
                "KeySchema": [
                    {
                        "AttributeName": "id",
                        "KeyType": "HASH"
                    }
                ],
                "ProvisionedThroughput": {
                    "ReadCapacityUnits": "5",
                    "WriteCapacityUnits": "5"
                },
                "AttributeDefinitions": [
                    {
                        "AttributeName": "id",
                        "AttributeType": "S"
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "0c458e02-382e-4316-82ff-0c9abf708819"
                }
            }
        },
        "DocperStorage": {
            "Type": "AWS::S3::Bucket",
            "Properties": {
                "BucketName": {
                    "Ref": "DocperS3BucketName"
                }
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "85e2cf8d-1306-4f4f-8dc1-f6fcfef1f509"
                }
            }
        },
        "DocperAPI": {
            "Type": "AWS::ApiGateway::RestApi",
            "Properties": {
                "Name": {
                    "Ref": "DocperAPIName"
                }
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "af816494-f425-45a7-bf88-b36269841cb8"
                }
            }
        },
        "Document": {
            "Type": "AWS::ApiGateway::Resource",
            "Properties": {
                "RestApiId": {
                    "Ref": "DocperAPI"
                },
                "PathPart": "stack",
                "ParentId": {
                    "Fn::GetAtt": [
                        "DocperAPI",
                        "RootResourceId"
                    ]
                }
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "88c45b66-cfb7-4938-a232-98dcf9aef0a3"
                }
            }
        },
        "GetDocument": {
            "Type": "AWS::ApiGateway::Method",
            "Properties": {
                "RestApiId": {
                    "Ref": "DocperAPI"
                },
                "ResourceId": {
                    "Ref": "Document"
                },
                "HttpMethod": "GET",
                "AuthorizationType": "NONE",
                "Integration": {
                    "RequestTemplates": {
                        "application/json": "{\"TableName\": \"DocperDocuments\"}"
                    },
                    "IntegrationResponses": [
                        {
                            "StatusCode": "200"
                        }
                    ],
                    "Type": "AWS",
                    "IntegrationHttpMethod": "POST",
                    "Uri": "arn:aws:apigateway:eu-west-1:dynamodb:action/Query",
                    "Credentials": {
                        "Fn::GetAtt": [
                            "GatewayRole",
                            "Arn"
                        ]
                    }
                },
                "MethodResponses": [
                    {
                        "StatusCode": 200
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "f9723173-6dfb-481f-887c-a638cb9eb807"
                }
            }
        },
        "Dep1": {
            "Type": "AWS::ApiGateway::Deployment",
            "Properties": {
                "RestApiId": {
                    "Ref": "DocperAPI"
                }
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "e08a9b03-443e-4b34-8dae-b84b7130c6a6"
                }
            },
            "DependsOn": [
                "GetDocument"
            ]
        },
        "TestingStage": {
            "Type": "AWS::ApiGateway::Stage",
            "Properties": {
                "RestApiId": {
                    "Ref": "DocperAPI"
                },
                "DeploymentId": {
                    "Ref": "Dep1"
                }
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "fb3b9ec7-7781-4a4e-a25b-92b22d3b8000"
                }
            }
        },
        "GatewayRole": {
            "Type": "AWS::IAM::Role",
            "Properties": {
                "RoleName": "RDSEnhancedMonitoringRole",
                "AssumeRolePolicyDocument": {
                    "Version": "2012-10-17",
                    "Statement": [
                        {
                            "Effect": "Allow",
                            "Principal": {
                                "Service": "apigateway.amazonaws.com"
                            },
                            "Action": "sts:AssumeRole"
                        }
                    ]
                },
                "ManagedPolicyArns": [
                    "arn:aws:iam::aws:policy/AmazonDynamoDBFullAccess"
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "63d535ce-4490-4542-8fcb-b412a5a3ce1b"
                }
            },
            "Condition": ""
        }
    },
    "Parameters": {
        "DocperDBTableName": {
            "Type": "String",
            "Default": "DocperDocuments",
            "Description": "The name of the DynamoDB that Docper should use"
        },
        "DocperS3BucketName": {
            "Type": "String",
            "Default": "docper-documents",
            "Description": "The name of the S3 bucket that Docper should use"
        },
        "DocperAPIName": {
            "Type": "String",
            "Default": "DocperDocumentsAPI",
            "Description": "The name of the Docper REST API"
        }
    }
}
